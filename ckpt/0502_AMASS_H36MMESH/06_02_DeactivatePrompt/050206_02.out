Adding new arg: args.config = ckpt/0502_AMASS_H36MMESH/06_02_DeactivatePrompt/config.yaml
Adding new arg: args.checkpoint = ckpt/0502_AMASS_H36MMESH/06_02_DeactivatePrompt
Adding new arg: args.seed = 0
Adding new arg: args.visualize = 
Adding new arg: args.eval_generalization = False
Adding new arg: args.quick_debug = False
Adding new arg: args.gpu = 6,7
Overriding existing arg: args.batch_size = 420
Adding new arg: args.classifier_type = task
Adding new arg: args.num_class = 4
Adding new arg: args.use_task_id_as_prompt = False
Adding new arg: args.reverse_query_prompt = False
Adding new arg: args.shuffle_batch = False
Adding new arg: args.reverse_query_prompt_per_iter = False
Adding new arg: args.vertex_x1000 = True
Adding new arg: args.aug2D = False
Adding new arg: args.out = 050206_02
Adding new arg: args.deactivate_prompt_branch = True

Configs: {'tasks': ['PE', 'MP', 'MC', 'FPE'], 'task_to_flag': {'PE': 0, 'MP': 1, 'FPE': 2, 'MC': 3, '2DAR': 4, 'AR': 5, 'MIB': 6}, 'dataset_to_flag': {'H36M_3D': 0, 'AMASS': 1, 'PW3D_MESH': 2, 'H36M_MESH': 3, 'H36M_MESH_TCMR': 4}, 'flag_to_task': {'0': 'PE', '1': 'MP', '2': 'FPE', '3': 'MC', '4': '2DAR', '5': 'AR', '6': 'MIB'}, 'flag_to_dataset': {'0': 'H36M_3D', '1': 'AMASS', '2': 'PW3D_MESH', '3': 'H36M_MESH', '4': 'H36M_MESH_TCMR'}, 'task_metrics': {'PE': ['PE e1', 'PE e2'], 'MP': ['MP'], 'FPE': ['FPE'], 'MC': ['MC'], '2DAR': ['2DAR'], 'AR': ['AR']}, 'dataset_task_info': {'train': {'AMASS': ['MP', 'MC', 'MIB'], 'H36M_MESH': ['PE', 'MC', 'MIB']}, 'test': {'AMASS': ['MP', 'MC', 'MIB'], 'H36M_MESH': ['PE', 'MC', 'MIB']}}, 'Mesh': {'enable': True, 'loss_type': 'L1', 'losses': {'loss_3d_pos': 0.5, 'loss_3d_velocity': 10, 'loss_pose': 1000, 'loss_shape': 1, 'loss_norm': 20, 'loss_3d_scale': 0, 'loss_lv': 0, 'loss_lg': 0, 'loss_a': 0, 'loss_av': 0}}, 'dataset_file': {'PW3D_MESH': 'data_icl_gen/VER5_DATA/PW3D_MESH/mesh_det_pw3d_EXTENDED.pkl', 'H36M_MESH': 'data_icl_gen/VER5_DATA/H36M_MESH/mesh_det_h36m_EXTENDED.pkl', 'AMASS': 'data_icl_gen/VER5_DATA/AMASS', 'H36M_3D': 'data_icl_gen/processed_data/H36M_3D/h36m_sh_conf_cam_source_final.pkl', 'H36M_MESH_TCMR': 'data_icl_gen/VER5_DATA/H36M_TCMR/h36m_train_25fps_db_RENAMED.pt'}, 'use_presave_data': True, 'aug': False, 'aug_shuffle_joints': False, 'current_as_history': True, 'clip_len': 16, 'max_len': 16, 'num_joint': 17, 'joint_mask_ratio': 0.4, 'frame_mask_ratio': 0.4, 'presave_folder': 'data_icl_gen/presave_data/', 'dataset_config': {'PW3D_MESH': {'sample_stride': 1, 'data_stride': {'train': 16, 'test': 32}, 'read_confidence': False, 'rootrel_input': True, 'rootrel_target': True, 'flip': True, 'use_global_orient': True}, 'H36M_MESH': {'sample_stride': 1, 'data_stride': {'train': 16, 'test': 32}, 'read_confidence': False, 'rootrel_input': True, 'rootrel_target': True, 'flip': True, 'use_global_orient': True}, 'AMASS': {'sample_stride': 1, 'data_stride': {'train': 128, 'test': 256}, 'read_confidence': False, 'rootrel_input': True, 'rootrel_target': True, 'flip': True, 'use_global_orient': True}, 'H36M_3D': {'sample_stride': 1, 'data_stride': {'train': 16, 'test': 32}, 'read_confidence': False, 'rootrel_input': True, 'rootrel_target': True, 'flip': True, 'scale_3D': 1}, 'H36M_MESH_TCMR': {'sample_stride': 1, 'data_stride': {'train': 16, 'test': 32}, 'read_confidence': False, 'rootrel_input': True, 'rootrel_target': True, 'flip': True, 'use_global_orient': True}}, 'func_ver': {'dataset_action_recognition': None, 'evaluate_action_recognition': None, 'train_epoch_action_recognition': None, 'dataset_non_AR': '5_ICL', 'evaluate_non_AR': '5_ICL', 'train_epoch_non_AR': '5_ICL', 'model_name': 'model_mesh.M01V02_MotionAGFormer'}, 'epochs': 120, 'batch_size': 420, 'test_batch_size': 512, 'learning_rate': 0.0002, 'weight_decay': 0.01, 'lr_decay': 0.99, 'losses': {'loss_mpjpe': 1.0, 'n_mpjpe': 0.5, 'loss_velocity': 20.0, 'loss_limb_var': 0, 'loss_limb_gt': 0, 'loss_angle': 0, 'loss_angle_velocity': 0}, 'no_eval': False, 'use_partial_data': False, 'partial_data': None, 'full_data': None, 'name': 'config', 'config': 'ckpt/0502_AMASS_H36MMESH/06_02_DeactivatePrompt/config.yaml', 'checkpoint': 'ckpt/0502_AMASS_H36MMESH/06_02_DeactivatePrompt', 'seed': 0, 'visualize': '', 'eval_generalization': False, 'quick_debug': False, 'gpu': '6,7', 'classifier_type': 'task', 'num_class': 4, 'use_task_id_as_prompt': False, 'reverse_query_prompt': False, 'shuffle_batch': False, 'reverse_query_prompt_per_iter': False, 'vertex_x1000': True, 'aug2D': False, 'out': '050206_02', 'deactivate_prompt_branch': True, 'data': None}

python train.py --config ckpt/0502_AMASS_H36MMESH/06_02_DeactivatePrompt/config.yaml -c ckpt/0502_AMASS_H36MMESH/06_02_DeactivatePrompt -gpu 6,7 -bs 420 -vertex_x1000 -deactivate_prompt_branch -out 050206_02

PID:  2268555

Overriding function... Using <prepare_motion> function from [model_mesh.M01V02_MotionAGFormer] instead of default from dataset ...

Overriding function... Using <preprocess> function from [model_mesh.M01V02_MotionAGFormer] instead of default from dataset ...

Loading dataset...
	Loading train data from [AMASS] for task: ['MP', 'MC', 'MIB']... Loading presaved... Loading joint masks... Loading frame masks... costs 1.46s... has 46726/46726 query/prompt samples
	Loading train data from [H36M_MESH] for task: ['PE', 'MC', 'MIB']... Loading presaved... Loading joint masks... Loading frame masks... costs 0.79s... has 18644/18644 query/prompt samples
	Training (non-AR) sample count: 65370
	Loading test data from [AMASS] for task: ['MP']... costs 0.00s... has 8492/46726 query/prompt samples
	Loading test data from [AMASS] for task: ['MC']... Loading joint masks... costs 0.01s... has 8492/46726 query/prompt samples
	Loading test data from [AMASS] for task: ['MIB']... Loading frame masks... costs 0.01s... has 8492/46726 query/prompt samples
	Loading test data from [H36M_MESH] for task: ['PE']... costs 0.00s... has 3088/18644 query/prompt samples
	Loading test data from [H36M_MESH] for task: ['MC']... Loading joint masks... costs 0.00s... has 3088/18644 query/prompt samples
	Loading test data from [H36M_MESH] for task: ['MIB']... Loading frame masks... costs 0.00s... has 3088/18644 query/prompt samples

Loading model...
	Model: model_mesh.M01V02_MotionAGFormer
	Trainable parameter count: 41.551018M

Training on [['non_AR', 156]] batches for 120 epochs. batch size: 420
[1 start]
	Iter: 52/156; time cost: 7.04min; current batch has {'AMASS': 906, 'H36M_MESH': 354} samples; batch_size (total/sub): 1260/420
	Iter: 104/156; time cost: 13.67min; current batch has {'AMASS': 903, 'H36M_MESH': 357} samples; batch_size (total/sub): 1260/420
	Evaluating [MP] on [AMASS]... Traceback (most recent call last):
  File "train.py", line 1046, in <module>
    train_with_config(args, opts)
  File "train.py", line 738, in train_with_config
    eval_results = evaluate(args, test_loader, datareader_pose_estimation, model_pos, dataset, eval_task, epoch=epoch, if_viz=opts.visualize, if_debug=opts.quick_debug)
  File "/home/wxs/Skeleton-in-Context-tpami/funcs_and_classes/Non_AR/eval_funcs/ver5_ICL.py", line 79, in evaluate
    query_target_dict, prompt_target_dict, info_dict, epoch, vertex_x1000=args.vertex_x1000)
  File "/home/wxs/anaconda3/envs/mdm/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/wxs/anaconda3/envs/mdm/lib/python3.7/site-packages/torch/nn/parallel/data_parallel.py", line 171, in forward
    outputs = self.parallel_apply(replicas, inputs, kwargs)
  File "/home/wxs/anaconda3/envs/mdm/lib/python3.7/site-packages/torch/nn/parallel/data_parallel.py", line 181, in parallel_apply
    return parallel_apply(replicas, inputs, kwargs, self.device_ids[:len(replicas)])
  File "/home/wxs/anaconda3/envs/mdm/lib/python3.7/site-packages/torch/nn/parallel/parallel_apply.py", line 89, in parallel_apply
    output.reraise()
  File "/home/wxs/anaconda3/envs/mdm/lib/python3.7/site-packages/torch/_utils.py", line 543, in reraise
    raise exception
RuntimeError: Caught RuntimeError in replica 0 on device 0.
Original Traceback (most recent call last):
  File "/home/wxs/anaconda3/envs/mdm/lib/python3.7/site-packages/torch/nn/parallel/parallel_apply.py", line 64, in _worker
    output = module(*input, **kwargs)
  File "/home/wxs/anaconda3/envs/mdm/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/wxs/Skeleton-in-Context-tpami/lib/model/model_mesh/M01V02_MotionAGFormer.py", line 391, in forward
    query = self.encode_joint(query_input, prompt_target_joint, 'query')     # [B,T,17,3] || [B,T,17,3] --> [B,T,17,6] --> [B,T,17,512]
  File "/home/wxs/Skeleton-in-Context-tpami/lib/model/model_mesh/M01V02_MotionAGFormer.py", line 333, in encode_joint
    x = self.spatial_patch_to_embedding[key](x)   # [B,T,17,512]
  File "/home/wxs/anaconda3/envs/mdm/lib/python3.7/site-packages/torch/nn/modules/module.py", line 1194, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/wxs/anaconda3/envs/mdm/lib/python3.7/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
RuntimeError: mat1 and mat2 shapes cannot be multiplied (69632x6 and 3x128)

